const LOCALID_MAGMA_GRUNT_1 =  5
const LOCALID_MAGMA_GRUNT_2 =  6
const LOCALID_ARCHIE 		=  7
const LOCALID_AQUA_GRUNT_1  =  8
const LOCALID_AQUA_GRUNT_2  =  9


script MeteorFalls_1F_1R_EventScript_MagmaStealsMeteoriteScene {
	lockall
	// special (SpawnCameraObject)
	setspeaker(Unknown)
	msgbox(MeteorFalls_1F_1R_Text_AndThatsWhy)
	
	closemessage
	setspeaker(Unknown)
	msgbox(MeteorFalls_1F_1R_Text_Understood)
	setspeaker(Player)
	msgbox(MeteorFalls_1F_1R_Text_FamiliarVoice)
	
	closemessage
	setspeaker(Magma)
	msgbox(MeteorFalls_1F_1R_Text_WithThisMeteorite)
	playbgm (MUS_ENCOUNTER_MAGMA, FALSE)
	// applymovement (OBJ_EVENT_ID_CAMERA, MeteorFalls_1F_1R_Movement_CameraPansToAquaMagma)
	playse(SE_PIN)
	applymovement (OBJ_EVENT_ID_PLAYER, Common_Movement_ExclamationMark)
	waitmovement (0)
	closemessage
	
	applymovement (OBJ_EVENT_ID_PLAYER, MeteorFalls_1F_1R_Movement_PlayerRescue)
	waitmovement (0)
	delay (30)
	applymovement (LOCALID_MAGMA_GRUNT_1, Common_Movement_WalkInPlaceDown)
	waitmovement (0)
	setspeaker("Cozmo")
	msgbox (MeteorFalls_1F_1R_Text_ThisIsAllIHave)
	closemessage
	
	msgbox(MeteorFalls_1F_1R_Text_PlayerWhatDoIDo)
	poryswitch(LANGUAGE) {
		EN{
			dynmultichoice(25, 8, TRUE, 4, 0, DYN_MULTICHOICE_CB_NONE, "Help him", "Just watch")
		}
		ES{
			dynmultichoice(25, 8, TRUE, 4, 0, DYN_MULTICHOICE_CB_NONE, "Ayudar", "Ver qué pasa")
		}
	}
	setspeaker(Player)
	if (var(VAR_RESULT) == 0){
		addvar(VAR_TEAM_AQUA_SIDE, 1)
		setflag(FLAG_MET_PROF_COZMO)
		msgbox(MeteorFalls_1F_1R_Text_PlayerRightHelp)
	}
	else {
		msgbox(MeteorFalls_1F_1R_Text_PlayerRightJustWatch)
	}
	closemessage
	
	applymovement (LOCALID_MAGMA_GRUNT_1, Common_Movement_WalkInPlaceFasterUp)
	applymovement (LOCALID_MAGMA_GRUNT_2, Common_Movement_WalkInPlaceFasterUp)
	waitmovement (0)
	playse (SE_PIN)
	applymovement (LOCALID_MAGMA_GRUNT_1, Common_Movement_ExclamationMark)
	waitmovement (0)
	applymovement (LOCALID_MAGMA_GRUNT_1, Common_Movement_Delay48)
	waitmovement (0)
	setspeaker(Magma)
	msgbox (MeteorFalls_1F_1R_Text_DontExpectMercyFromMagma, MSGBOX_DEFAULT)
	closemessage
	applymovement (LOCALID_MAGMA_GRUNT_1, MeteorFalls_1F_1R_Movement_MagmaGruntApproachPlayer)
	waitmovement (0)
	if (var(VAR_RESULT) == 1)
	{
		trainerbattle_no_intro (TRAINER_GRUNT_MAGMA_HIDEOUT_3, MeteorFalls_1F_1R_Text_WhatIsThisChild)
		setspeaker(Magma)
		msgbox(MeteorFalls_1F_1R_Text_WhatIsThisYOU)
		msgbox(MeteorFalls_1F_1R_Text_ShutUp)
	}
	setspeaker(Unknown)
	msgbox (MeteorFalls_1F_1R_Text_HoldItRightThereMagma)
	applymovement (LOCALID_MAGMA_GRUNT_1, Common_Movement_WalkInPlaceFasterLeft)
	applymovement (LOCALID_MAGMA_GRUNT_2, Common_Movement_WalkInPlaceFasterLeft)
	waitmovement (0)
	setspeaker (Magma)
	msgbox(MeteorFalls_1F_1R_Text_MagmaConfusion)
	
	if (flag(FLAG_MET_PROF_COZMO)){
		
		dynmultichoice(25, 9, TRUE, 4, 0, DYN_MULTICHOICE_CB_NONE, "¡Hacer algo!")
	}
	else{
		dynmultichoice(25, 8, TRUE, 4, 0, DYN_MULTICHOICE_CB_NONE, "¡Hacer algo!", "No hacer nada")
	}
	closemessage
	if (var(VAR_RESULT) == 0){
		applymovement(OBJ_EVENT_ID_PLAYER, Common_Movement_WalkInPlaceDown)
		waitmovement (0)
		giveitem(ITEM_METEORITE)
	}
	setspeaker(Aqua)
	msgbox(MeteorFalls_1F_1R_Text_GotCarriedAway)
	
	closemessage
	applymovement (OBJ_EVENT_ID_PLAYER, Common_Movement_WalkInPlaceFasterLeft)
	waitmovement (0)
	addobject (LOCALID_ARCHIE)
	addobject (LOCALID_AQUA_GRUNT_1)
	addobject (LOCALID_AQUA_GRUNT_2)
	playbgm (MUS_ENCOUNTER_AQUA, FALSE)
	applymovement (LOCALID_ARCHIE, MeteorFalls_1F_1R_Movement_ArchieArrive)
	applymovement (LOCALID_AQUA_GRUNT_1, MeteorFalls_1F_1R_Movement_AquaGrunt1Arrive)
	applymovement (LOCALID_AQUA_GRUNT_2, MeteorFalls_1F_1R_Movement_AquaGrunt2Arrive)
	waitmovement (0)
	applymovement (LOCALID_MAGMA_GRUNT_1, Common_Movement_WalkInPlaceFasterLeft)
	applymovement (LOCALID_MAGMA_GRUNT_2, Common_Movement_WalkInPlaceFasterLeft)
	waitmovement (0)
	setspeaker(Magma)
	msgbox (MeteorFalls_1F_1R_Text_BeSeeingYouTeamAqua, MSGBOX_DEFAULT)
	closemessage
	
	applymovement (OBJ_EVENT_ID_PLAYER, MeteorFalls_1F_1R_Movement_PushPlayerOutOfWay)
	applymovement (LOCALID_MAGMA_GRUNT_1, MeteorFalls_1F_1R_Movement_MagmaGrunt1Exit)
	applymovement (LOCALID_MAGMA_GRUNT_2, MeteorFalls_1F_1R_Movement_MagmaGrunt2Exit)
	waitmovement (0)
	removeobject (LOCALID_MAGMA_GRUNT_1)
	removeobject (LOCALID_MAGMA_GRUNT_2)
	applymovement (LOCALID_ARCHIE, MeteorFalls_1F_1R_Movement_ArchieApproachPlayer)
	waitmovement (0)
	setspeaker (Archie)
	if (flag(FLAG_MET_PROF_COZMO) && var(VAR_TEAM_AQUA_SIDE) >= 1){
		msgbox(MeteorFalls_1F_1R_Text_ArchieHelpedBothTimes)
	}
	elif (!flag(FLAG_MET_PROF_COZMO) && var(VAR_TEAM_AQUA_SIDE) >= 1){
		msgbox(MeteorFalls_1F_1R_Text_ArchieHelpedBeforeNotNow)
	}
	else {
		msgbox(MeteorFalls_1F_1R_Text_ArchieNeverHelped)
	}
	closemessage
	
	applymovement (LOCALID_AQUA_GRUNT_1, MeteorFalls_1F_1R_Movement_AquaGrunt1ApproachArchie)
	applymovement (LOCALID_AQUA_GRUNT_2, MeteorFalls_1F_1R_Movement_AquaGrunt2ApproachArchie)
	waitmovement (0)
	applymovement (LOCALID_ARCHIE, Common_Movement_WalkInPlaceFasterDown)
	waitmovement (0)
	applymovement (LOCALID_ARCHIE, Common_Movement_WalkInPlaceFasterLeft)
	waitmovement (0)
	applymovement (LOCALID_ARCHIE, MeteorFalls_1F_1R_Movement_ArchieExit)
	applymovement (LOCALID_AQUA_GRUNT_1, MeteorFalls_1F_1R_Movement_AquaGrunt1Exit)
	applymovement (LOCALID_AQUA_GRUNT_2, MeteorFalls_1F_1R_Movement_AquaGrunt2Exit)
	waitmovement (0)
	fadedefaultbgm
	removeobject (LOCALID_ARCHIE)
	removeobject (LOCALID_AQUA_GRUNT_1)
	removeobject (LOCALID_AQUA_GRUNT_2)
	setflag (FLAG_HIDE_ROUTE_112_TEAM_MAGMA)
	setflag (FLAG_MET_ARCHIE_METEOR_FALLS)
	setflag (FLAG_HIDE_FALLARBOR_TOWN_BATTLE_TENT_SCOTT)
	setvar (VAR_METEOR_FALLS_STATE, 1)
	setvar (VAR_MT_CHIMNEY_STATE, 10)
	clearflag(FLAG_MET_PROF_COZMO)
	releaseall
	end
}

script MeteorFalls_1F_1R_EventScript_ProfCozmo {
	lock
	faceplayer
	if (flag(FLAG_MET_PROF_COZMO)){
		msgbox(MeteorFalls_1F_1R_Text_WhatsTeamMagmaDoingAtMtChimney)
	}
	else {
		setflag(FLAG_MET_PROF_COZMO)
		msgbox(MeteorFalls_1F_1R_Text_MeetProfCozmo)
	}
	if (checkitem(ITEM_METEORITE)){
		call (FallarborTown_CozmosHouse_EventScript_NoticeMeteorite)
		msgbox(FallarborTown_CozmosHouse_Text_PleaseUseThisTM)
		if (!giveitem(ITEM_TM60)){
			call(Common_EventScript_ShowBagIsFull)
		}
		setvar(VAR_0x8004, ITEM_METEORITE)
		call(Common_EventScript_PlayerHandedOverTheItem)
		msgbox(FallarborTown_CozmosHouse_Text_ReallyGoingToHelpMyResearch)
	}
	release
	end
}

movement MeteorFalls_1F_1R_Movement_PlayerRescue {
	player_run_left * 12
	player_run_down
	walk_in_place_faster_down
}


raw `
.set LOCALID_MAGMA_GRUNT_1, 5
.set LOCALID_MAGMA_GRUNT_2, 6
.set LOCALID_ARCHIE, 7
.set LOCALID_AQUA_GRUNT_1, 8
.set LOCALID_AQUA_GRUNT_2, 9

MeteorFalls_1F_1R_MapScripts::
	map_script MAP_SCRIPT_ON_LOAD, MeteorFalls_1F_1R_OnLoad
	.byte 0

MeteorFalls_1F_1R_OnLoad:
	call_if_set FLAG_SYS_GAME_CLEAR, MeteorFalls_1F_1R_EventScript_OpenStevensCave
	end

MeteorFalls_1F_1R_EventScript_OpenStevensCave::
	setmetatile 4, 1, METATILE_MeteorFalls_CaveEntrance_Top, TRUE
	setmetatile 3, 2, METATILE_MeteorFalls_CaveEntrance_Left, TRUE
	setmetatile 4, 2, METATILE_MeteorFalls_CaveEntrance_Bottom, FALSE
	setmetatile 5, 2, METATILE_MeteorFalls_CaveEntrance_Right, TRUE
	return



MeteorFalls_1F_1R_Movement_MagmaGruntApproachPlayer:
	walk_right
	walk_right
	walk_in_place_faster_up
	step_end

MeteorFalls_1F_1R_Movement_MagmaGrunt1Exit:
	walk_fast_up
	walk_fast_up
	walk_fast_right
	walk_fast_right
	walk_fast_right
	walk_fast_right
	walk_fast_right
	walk_fast_right
	walk_fast_right
	step_end

MeteorFalls_1F_1R_Movement_MagmaGrunt2Exit:
	walk_fast_up
	walk_fast_up
	walk_fast_up
	walk_fast_right
	walk_fast_right
	walk_fast_right
	walk_fast_right
	walk_fast_right
	walk_fast_right
	walk_fast_right
	step_end

MeteorFalls_1F_1R_Movement_ArchieArrive:
	walk_right
	walk_right
	walk_right
	walk_right
	walk_right
	walk_right
	step_end

MeteorFalls_1F_1R_Movement_AquaGrunt1Arrive:
	delay_16
	delay_16
	walk_right
	walk_right
	walk_right
	walk_right
	walk_right
	step_end

MeteorFalls_1F_1R_Movement_AquaGrunt2Arrive:
	delay_16
	delay_16
	walk_right
	walk_right
	walk_right
	walk_right
	walk_right
	step_end

MeteorFalls_1F_1R_Movement_ArchieExit:
	walk_right
	walk_right
	walk_right
	walk_right
	walk_right
	walk_right
	walk_right
	step_end

MeteorFalls_1F_1R_Movement_ArchieApproachPlayer:
	walk_right
	walk_right
	walk_up
	walk_up
	walk_in_place_faster_left
	step_end

MeteorFalls_1F_1R_Movement_AquaGrunt1Exit:
	walk_up
	walk_up
	walk_right
	walk_right
	walk_right
	walk_right
	walk_right
	walk_right
	walk_right
	step_end

MeteorFalls_1F_1R_Movement_AquaGrunt1ApproachArchie:
	walk_right
	walk_right
	walk_right
	walk_in_place_faster_up
	step_end

MeteorFalls_1F_1R_Movement_AquaGrunt2Exit:
	walk_up
	walk_up
	walk_up
	walk_right
	walk_right
	walk_right
	walk_right
	walk_right
	walk_right
	walk_right
	step_end

MeteorFalls_1F_1R_Movement_AquaGrunt2ApproachArchie:
	walk_right
	walk_right
	walk_right
	walk_in_place_faster_up
	step_end

MeteorFalls_1F_1R_Movement_PushPlayerOutOfWay:
	walk_in_place_faster_down
	delay_4
	walk_in_place_faster_right
	lock_facing_direction
	walk_left
	unlock_facing_direction
	face_right
	step_end




`
